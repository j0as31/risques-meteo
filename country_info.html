<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informations sur les Pays</title>
    <!-- Inclure Tailwind CSS pour un style moderne et responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            border-radius: 0.75rem; /* Coins arrondis */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }
        .country-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            background-color: #f9fafb;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .country-card img {
            max-width: 150px;
            height: auto;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container">
        <!-- Titre de la page -->
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-6">
            Informations sur les Pays
        </h1>

        <!-- Bouton de navigation vers la carte des séismes -->
        <div class="flex justify-center mb-6">
            <a href="index.html" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150">
                Retour à la carte des séismes
            </a>
        </div>

        <!-- Section de recherche de pays -->
        <div class="flex flex-col sm:flex-row gap-4 mb-6 justify-center items-center">
            <input type="text" id="countryInput" placeholder="Entrez le nom d'un pays (ex: France)"
                   class="p-3 border border-gray-300 rounded-md w-full sm:w-2/3 focus:outline-none focus:ring-2 focus:ring-green-500">
            <button id="searchButton"
                    class="px-6 py-3 bg-green-600 text-white font-semibold rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition ease-in-out duration-150 w-full sm:w-1/3">
                Rechercher
            </button>
        </div>

        <!-- Zone d'affichage des informations du pays -->
        <div id="countryInfo" class="country-card hidden">
            <!-- Les informations du pays seront insérées ici par JavaScript -->
        </div>

        <!-- Message d'erreur/information -->
        <div id="message" class="text-center text-red-600 mt-4 hidden">
            <!-- Les messages d'erreur ou d'information seront affichés ici -->
        </div>

        <!-- Message de chargement -->
        <div id="loading-message-country" class="text-center text-blue-600 mt-4 hidden">
            Chargement des informations...
        </div>
    </div>

    <script>
        // Fonction utilitaire pour formater une date au format YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Mois est basé sur 0
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Fonction pour afficher un message à l'utilisateur (succès ou erreur)
        function displayMessage(text, isError = false) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `text-center mt-4 p-2 rounded-md ${isError ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}`;
            messageDiv.classList.remove('hidden');
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000); // Masquer le message après 5 secondes
        }

        // Fonction pour récupérer et afficher les informations d'un pays
        async function getCountryInfo(countryName) {
            const countryInfoDiv = document.getElementById('countryInfo');
            const loadingMessage = document.getElementById('loading-message-country');
            const messageDiv = document.getElementById('message');

            countryInfoDiv.classList.add('hidden'); // Cacher la carte d'info avant de charger
            messageDiv.classList.add('hidden'); // Cacher les messages précédents
            loadingMessage.classList.remove('hidden'); // Afficher le message de chargement

            try {
                // 1. Récupération des informations générales du pays
                const response = await fetch(`https://restcountries.com/v3.1/name/${countryName}?fullText=true`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        displayMessage(`Pays "${countryName}" non trouvé. Veuillez vérifier l'orthographe.`, true);
                    } else {
                        throw new Error(`Erreur HTTP: ${response.status}`);
                    }
                    return;
                }

                const data = await response.json();
                const country = data[0];

                // Préparer le contenu HTML pour les informations générales du pays
                let countryHtml = `
                    <div class="flex items-center mb-4">
                        <img src="${country.flags.png}" alt="Drapeau de ${country.name.common}" class="w-24 h-auto mr-4 rounded-md shadow-sm">
                        <h2 class="text-2xl font-bold text-gray-900">${country.name.common}</h2>
                    </div>
                    <p><b>Capitale:</b> ${country.capital ? country.capital[0] : 'N/A'}</p>
                    <p><b>Région:</b> ${country.region}</p>
                    <p><b>Sous-région:</b> ${country.subregion || 'N/A'}</p>
                    <p><b>Population:</b> ${country.population.toLocaleString('fr-FR')}</p>
                    <p><b>Superficie:</b> ${country.area.toLocaleString('fr-FR')} km²</p>
                    <p><b>Langues:</b> ${Object.values(country.languages || {}).join(', ') || 'N/A'}</p>
                    <p><b>Monnaies:</b> ${Object.values(country.currencies || {}).map(c => c.name).join(', ') || 'N/A'}</p>
                    <p><b>Fuseaux horaires:</b> ${country.timezones.join(', ')}</p>
                    <p><b>Domaine de premier niveau:</b> ${country.tld ? country.tld[0] : 'N/A'}</p>
                `;

                // 2. Récupération des informations sismiques
                // Vérifier si les coordonnées de la capitale sont disponibles
                if (country.latlng && country.latlng.length === 2) {
                    const lat = country.latlng[0];
                    const lon = country.latlng[1];

                    const today = new Date();
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(today.getDate() - 30);

                    const startDate = formatDate(thirtyDaysAgo);
                    const endDate = formatDate(today);

                    // API USGS pour les séismes dans un rayon de 1000 km autour de la capitale
                    const seismicApiUrl = `https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&latitude=${lat}&longitude=${lon}&maxradiuskm=1000&starttime=${startDate}&endtime=${endDate}&minmagnitude=2.5`;

                    let seismicCount = 'N/A';
                    let maxMagnitude = 'N/A';

                    try {
                        const seismicResponse = await fetch(seismicApiUrl);
                        if (!seismicResponse.ok) {
                            throw new Error(`Erreur HTTP sismique: ${seismicResponse.status}`);
                        }
                        const seismicData = await seismicResponse.json();

                        seismicCount = seismicData.features.length;
                        let tempMaxMagnitude = 0;
                        if (seismicCount > 0) {
                            seismicData.features.forEach(eq => {
                                if (eq.properties.mag > tempMaxMagnitude) {
                                    tempMaxMagnitude = eq.properties.mag;
                                }
                            });
                            maxMagnitude = tempMaxMagnitude;
                        } else {
                            maxMagnitude = 'Aucun séisme > 2.5';
                        }

                    } catch (seismicError) {
                        console.error('Erreur lors de la récupération des données sismiques:', seismicError);
                        seismicCount = `Erreur de chargement`;
                        maxMagnitude = `Erreur de chargement`;
                        displayMessage(`Erreur lors du chargement des données sismiques pour ${country.name.common}.`, true);
                    }

                    // Ajouter les informations sismiques au HTML
                    countryHtml += `
                        <div class="seismic-info mt-4 pt-4 border-t border-gray-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Activité Sismique (30 derniers jours, rayon de 1000 km autour de la capitale)</h3>
                            <p><b>Nombre de séismes (Mag > 2.5):</b> ${seismicCount}</p>
                            <p><b>Magnitude maximale:</b> ${maxMagnitude}</p>
                        </div>
                    `;
                } else {
                    countryHtml += `
                        <div class="seismic-info mt-4 pt-4 border-t border-gray-200 text-gray-600">
                            <p>Coordonnées de la capitale non disponibles pour l'activité sismique.</p>
                        </div>
                    `;
                }

                countryInfoDiv.innerHTML = countryHtml;
                countryInfoDiv.classList.remove('hidden');
                displayMessage(`Informations pour ${country.name.common} chargées avec succès.`, false);

            } catch (error) {
                console.error('Erreur lors de la récupération des informations du pays:', error);
                displayMessage(`Une erreur est survenue lors du chargement des données. Détails: ${error.message}`, true);
            } finally {
                loadingMessage.classList.add('hidden');
            }
        }

        // Attendre que le DOM soit complètement chargé
        document.addEventListener('DOMContentLoaded', () => {
            const countryInput = document.getElementById('countryInput');
            const searchButton = document.getElementById('searchButton');

            // Ajouter un écouteur d'événement au bouton de recherche
            searchButton.addEventListener('click', () => {
                const countryName = countryInput.value.trim();
                if (countryName) {
                    getCountryInfo(countryName);
                } else {
                    displayMessage("Veuillez entrer le nom d'un pays.", true);
                }
            });

            // Permettre la recherche en appuyant sur "Entrée" dans le champ de texte
            countryInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    searchButton.click();
                }
            });
        });
    </script>
</body>
</html>
